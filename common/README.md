# `common/`: LALSuite common code and maintainer scripts

This directory contains common code used by the constituent LALSuite
packages. It also contains miscellaneous scripts useful for maintenance.

## `common/conda/`: LALSuite Conda packages

This directory contains common code for Conda packages.

## `common/debian/`: LALSuite Debian packages

This directory contains common code for Debian packages.

## `common/doxygen/`: LALSuite Doxygen documentation

Online HTML documentation for the LALSuite C libraries and Pure-python extras
is generated using [Doxygen](http://www.doxygen.nl/).

This directory contains the common files that are shared between the doxygen
builds for all of the LALSuite subpackages.

The build is controlled by the automake file `gnuscripts/lalsuite_doxygen.am`,
customisations for each subpackage can be added in
`<package>/doxygen/Makefile.am`.

## `common/maintainer-scripts`: Maintainer scripts

This directory contains miscellaneous scripts useful for maintenance.

## `common/swig`: LALSuite SWIG Bindings

The LALSuite C libraries are wrapped using [SWIG](http://swig.org/)
to provide Octave and Python bindings for each library.

The wrappings are built as follows:

1. A boilerplate pre-processed interface file `swig<package>.i_preproc.i` is
   generated that `%include`s all of the package header (`.h`) files.

2. An XML representation of the library is generated by running
   `swig -xml swig<package>.i_preproc.i`.

3. The XML representation is passed to `generate_swig_iface.py` to generate
   the actual SWIG interface file `swig<package>i`.

   This script also handles generic object renaming (e.g. stripping `XLAL`
   prefices from functions). See `swig_function_prefixes` in the
   `<package>/swig/Makefile.am` for each package for the list of prefixes that are
   stripped, and `common/swig/generate_swig_iface.py` for the variable and constant
   renames.

4. The SWIG C library files for each high-level binding are generated by
   running `swig -{octave,python} swig<package>.i`.

   The following files modify the build for each subpackage:

   - `<package>/swig/SWIGCommon.i` (LAL only)
   - `<package>/swig/SWIG<Package>Alpha.i` (always `%include`d first)
   - `<package>/swig/SWIG<Package>Omega.i` (always `%include`d last)
   - `<package>/swig/SWIGOctave.i`
   - `<package>/swig/SWIGPython.i`

5. The C library for each binding is compiled.

## `common/test`: Test utilities for LALSuite

This directory contains generic testing utilities for LALSuite.

### `test_python_imports.py`

This script discovers all python modules in the `<package>/python/<package>/`
tree and sets up a unit test to run `import <module>`.

This script must be symlinked to `<package>/test/python/` and
referenced from the `Makefile.am` in that directory to run properly.

It can be accompanied by `exclude-modules.txt` (in the same directory) that lists out
the _file paths_ of modules to exclude from the test relative to the `<package>/python/`
directory, e.g. to exclude `lal.git_version` from the tests you would put

```
lal/git_version.py
```

into `exclude-modules.txt`.

### `test_python_scripts.py`

This script discovers all python scripts in the `<package>/python` directory
and sets up a unit test to run `<script> --help` in a shell.

This script must be symlinked to `<package>/test/python/` and
referenced from the `Makefile.am` in that directory to run properly.

It can be accompanied by `exclude-scripts.txt` (in the same directory) that lists out
the name of scripts (no directory, no extension) to exclude from the test,
e.g. to exclude `lal_my_awesome_tool` (built from `lal/python/lal_my_awesome_tool.py`)
from the tests you would put

```
lal_my_awesome_tool
```

into `exclude-scripts.txt`.
